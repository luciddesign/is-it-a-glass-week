<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Recycling Calendar</title>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
  <link rel="stylesheet" href="styles.css" type="text/css">
  <script src="http://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script>
  <script>
  function getUrlParameter(sParam)
  {
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++)
    {
      var sParameterName = sURLVariables[i].split('=');
      if (sParameterName[0] == sParam)
      {
        return sParameterName[1];
      }
    }
  }

  $(function() {
    //Returns ISO 8601 week number and year
    Date.prototype.getFullWeek = function(){
      var jan1, w, d = new Date(this);
      d.setDate(d.getDate()+4-(d.getDay()||7));		// Set to nearest Thursday: current date + 4 - current day number, make Sunday's day number 7
      jan1 = new Date(d.getFullYear(),0,1);		// Get first day of year
      w = Math.ceil((((d-jan1)/86400000)+1)/7);		// Calculate full weeks to nearest Thursday
      return {y: d.getFullYear(), w: w };
    };
    //Returns ISO 8601 week number
    Date.prototype.getWeek = function(){
      return this.getFullWeek().w;
    };

    if(getUrlParameter('date') == null) {
      var today = new Date();
    }
    else
    {
      var today = new Date(getUrlParameter('date'));
    }

    var currentWeekNumber = today.getWeek();

    navigator.geolocation.getCurrentPosition(function (pos) {
      var geocoder = new google.maps.Geocoder();
      var lat = pos.coords.latitude;
      var lng = pos.coords.longitude;
      var latlng = new google.maps.LatLng(lat, lng);

      //reverse geocode the coordinates, returning location information.
      geocoder.geocode({ 'latLng': latlng }, function (results, status) {
        var result = results[0];
        var region = '';

        for (var i = 0, len = result.address_components.length; i < len; i++) {
          var ac = result.address_components[i];

          if (ac.types.indexOf('sublocality') >= 0) {
            region = ac.short_name;
          }
        }

        if(getUrlParameter('region') != null) {
          region = getUrlParameter('region');
        }

        $('.region').html(region + " ");

        if(region.indexOf("Nelson") > -1) {
          if(currentWeekNumber % 2 == 0) {
            var putOut = "Plastic, cans, paper and cardboard";
            $('body').addClass('other');
            $('body').removeClass('glass');
          }
          else {
            var putOut = "Glass";
            $('body').addClass('glass');
            $('body').removeClass('other');
          }

          $(".put-out").html(putOut);
          $(".nope").hide();
        }
        else {
          $('body').removeClass('glass');
          $('body').removeClass('other');

          $(".put-out").hide();
          $(".nope").show();
        }
      });
    });
  });
  </script>
</head>
<body>
  <div class="outer">
    <div class="middle">
      <div class="inner">
        <h1><span class="region"></span>Recycling Calendar</h1>
        <i class="fa fa-recycle fa-5x"></i>
        <h2>This Week</h2>
        <div class="put-out"></div>
        <div class="nope">
          <p>Sorry, we don&rsquo;t have details for <span class="region">your region</span></p>
          <div class="createsend-button" style="height:27px;display:inline-block;" data-listid="r/AA/EA1/B92/821DBC95DFD83ECD">
</div><script type="text/javascript">(function () { var e = document.createElement('script'); e.type = 'text/javascript'; e.async = true; e.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://btn.createsend1.com/js/sb.min.js?v=3'; e.className = 'createsend-script'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(e, s); })();</script>
        </div>
      </div>
    </div>
  </div>
  <div class="credits">A project by <a href="http://www.lucid.co.nz">Lucid</a>. &copy;2015 All rights reserved.</div>

  <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '5500097792c6ac438d00acb6');
    t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
    t.src = 'https://track.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
  </script>
</body>
</html>
